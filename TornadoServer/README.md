# Tornado server

#### This server handle communication between backend script (so MQTT with data) and the user, showing them data using web pages

Communication uses WebSocket protocol to tranfer data, there is a single bidirectional channel backend-tornado and multiple bidirection channels tornado-webpage one for every instance of the page open

Consult [WS packet format](#WS-packet-format)

### WS packets format

It's necessary to identify different types of packet in order to handle requests

| Type | Use |
|------|-----|
| RealTimeData | Send real time data to all the clients |
| ServerHandshake | Identify the backend channel |
| StoricDataRequest | Request a particular interval of storic data, from client to server
| StoricDataServe | Send the requested data to the right client, Note id is generated by tornato to keep track of the page who asked data

### Payloads
```JSON
 RealTimeData
 {
   "type" : "RealTimeData",
   "payload" : {}
 }
 
 ServerHandshake
 {
   "type" : "ServerHandshake"
 }

 StoricDataRequest
 { 
   "type" : "StoricDataRequest",
   "payload" : 
     {
       "startTime": "yyyy-mm-dd",
       "endTime": "yyyy-mm-dd",
     }
 }

 StoricDataServe
 { 
   "type" : "StoricDataServe",
   "payload" : 
     {
       "data": {},
       "id" : 0
     } 
 }
```
